{
    "type": "WizardScriptElement",
    "config": {
        "script": "var navigationController=new NavigationMenuModule({\n      \"Main\":[\n        {\n          html:\"Dashboard\",\n        },\n        {\n          html:\"Projects\",\n          formatEl:function(li){\n              ProjectTeam.CurrentTeam().runOnceOnLoad(function(team){\n                  \n                    var setCounter=function(){\n                        var l=team.getProjects().length;\n                       \n                        li.setAttribute('data-counter',l);\n                        li.setAttribute('data-counter-complete',team.getProjects().filter(function(p){\n                            return p.isComplete();\n                        }).length+'\/'+l)\n                        if(l>0){\n                            li.addClass('has-items')\n                        }else{\n                            li.removeClass('has-items')\n                        }\n                    }\n                  \n                   setCounter();\n                   navigationController.addWeakEvent(team, 'addProject', setCounter);\n                   navigationController.addWeakEvent(team, 'assignUser', setCounter);\n                   navigationController.addWeakEvent(team, 'removeProject', setCounter);\n                   navigationController.addWeakEvent(team, 'projectStatusChanged', setCounter);\n                  \n              });\n             \n          },\n            urlComponent:function(stub, segments){\n            \n                var current=application.getNamedValue(\"currentProject\");\n            \n                if(segments&&segments[0].indexOf('Project-')===0){\n                    \n                    if(current&&'Project-'+current.getId()!==segments[0]){\n                        console.warn('should set current');\n                    }\n                    \n                    return 'Projects\/'+segments[0];\n                }\n                \n                if(!current){\n                    return stub;\n                }\n                \n                return 'Projects\/Project-'+current.getId()\n           }\n        },\n\n        {\n          html:\"Tasks\",\n          formatEl:function(li){\n              ProjectTeam.CurrentTeam().runOnceOnLoad(function(team){\n                  \n                    var setCounter=function(){\n                        var l=team.getTasks().length;\n                        li.setAttribute('data-counter',l);\n                        li.setAttribute('data-counter-complete',team.getTasks().filter(function(t){\n                            return t.isComplete();\n                        }).length+'\/'+l)\n                        \n                        if(l>0){\n                            li.addClass('has-items')\n                        }else{\n                            li.removeClass('has-items')\n                        }\n                    }\n                  \n                   setCounter();\n                   navigationController.addWeakEvent(team, 'addTask', setCounter);\n                   navigationController.addWeakEvent(team, 'assignUser', setCounter);\n                   navigationController.addWeakEvent(team, 'removeTask', setCounter);\n                  \n              });\n             \n          }\n        },\n        {\n          html:\"Calendar\",\n          urlComponent:function(){\n              \n            var todayStr = (new Date()).toISOString().split('T')[0];\n              \n            if (!application.getNamedValue(\"selectedDay\")) {\n\t\t\t\tapplication.setNamedValue(\"selectedDay\",todayStr);\n\t\t\t}\n             \n            var dayStr=application.getNamedValue(\"selectedDay\");\n            return 'Calendar\/'+(dayStr===todayStr?\"Today\":dayStr);\n          },\n        },\n        {\n          html:\"Activity\",\n        },\n        {\n          html:\"Map\",\n        }\n      ],\n      \"People\":[\n        {\n          html:\"Projects\",\n        },\n        {\n          html:\"Clients\",\n          \n        },\n        {\n          name:\"Users\",\n          html:\"Team\",\n          urlComponent:function(){\n              return 'Team';\n          },\n          formatEl:function(li){\n              ProjectTeam.CurrentTeam().runOnceOnLoad(function(team){\n                  \n                    var setCounter=function(){\n                        team.getUsers(function(users){\n                            \n                            \n                            \n                            var l=users.filter(function(u){\n                                return true;\n                            }).length;\n                            li.setAttribute('data-counter',l);\n                            if(l>0){\n                                li.addClass('has-items')\n                            }else{\n                                li.removeClass('has-items')\n                            }\n                        })\n                    }\n                  \n                   setCounter();\n                   navigationController.addWeakEvent(team, 'addUser', setCounter);\n                   navigationController.addWeakEvent(team, 'assignUser', setCounter);\n                   navigationController.addWeakEvent(team, 'removeUser', setCounter);\n                  \n              });\n             \n          }\n        }\n      ],\n    \/\/   \"Accounting\":[\n    \/\/     {\n    \/\/       html:\"Documents\",\n    \/\/     },\n    \/\/     {\n    \/\/       html:\"Timesheet\",\n    \/\/     },\n    \/\/     {\n    \/\/       html:\"Reports\"\n    \/\/     }\n    \/\/   ] \n     \n      \"Community\":[\n        {\n          html:\"Cultural\",\n        },\n        {\n          html:\"Transportation\",\n        },\n        {\n          html:\"Habitation\"\n        },\n        {\n          html:\"Environmental\"\n        },\n        {\n          html:\"Subsistence\"\n        },\n        {\n          html:\"Users\",\n          formatEl:function(li){\n              ProjectTeam.CurrentTeam().runOnceOnLoad(function(team){\n                  \n                     var setCounter=function(){\n                        team.getAllUsers(function(users){\n                            \n                            \n                            \n                            var l=users.filter(function(u){\n                                var r=u.getRoles();\n                                return (!r)||r.length==0||r.indexOf('none')>=0||r.indexOf('community-member')>=0;\n                            }).length;\n                            \n                            \n                            var n=users.filter(function(u){\n                                var r=u.getRoles();\n                                return (!r)||r.length==0||r.indexOf('none')>=0;\n                            }).length;\n                            \n                            li.setAttribute('data-counter',l+(n>0?\" (\"+n+\")\":\"\"));\n                            \n                            if(l>0){\n                                li.addClass('has-items')\n                            }else{\n                                li.removeClass('has-items')\n                            }\n                            \n                            if(n>0){\n                                li.addClass('has-new-items')\n                            }else{\n                                li.removeClass('has-new-items')\n                            }\n                            \n                        })\n                    }\n                  \n                   setCounter();\n                   navigationController.addWeakEvent(team, 'addUser', setCounter);\n                   navigationController.addWeakEvent(team, 'assignUser', setCounter);\n                   navigationController.addWeakEvent(team, 'removeUser', setCounter);\n                  \n              });\n             \n          }\n        },\n        {\n            html:\"Mobile\",\n            formatEl:function(li){\n              ProjectTeam.CurrentTeam().runOnceOnLoad(function(team){\n                  \n                     var setCounter=function(){\n                        team.getDevices(function(users){\n                            \n                            \n                            \n                            var l=users.filter(function(u){\n                                var r=u.getRoles();\n                                return (!r)||r.length==0||r.indexOf('none')>=0||r.indexOf('community-member')>=0;\n                            }).length;\n                            \n                            \n                            var n=users.filter(function(u){\n                                var r=u.getRoles();\n                                return (!r)||r.length==0||r.indexOf('none')>=0;\n                            }).length;\n                            \n                            li.setAttribute('data-counter',l+(n>0?\" (\"+n+\")\":\"\"));\n                            \n                            if(l>0){\n                                li.addClass('has-items')\n                            }else{\n                                li.removeClass('has-items')\n                            }\n                            \n                            if(n>0){\n                                li.addClass('has-new-items')\n                            }else{\n                                li.removeClass('has-new-items')\n                            }\n                            \n                        })\n                    }\n                  \n                   setCounter();\n                   navigationController.addWeakEvent(team, 'addUser', setCounter);\n                   navigationController.addWeakEvent(team, 'assignUser', setCounter);\n                   navigationController.addWeakEvent(team, 'removeUser', setCounter);\n                  \n              });\n             \n          }\n        }\n      ],\n      \"Configuration\":[\n        {\n            html:\"Archive\"\n        },\n        {\n          html:\"Settings\",\n        },\n        {\n          html:\"Export\",\n          events:{\n                click:function(){\n                    \n                    \n                    var exportQuery=new AjaxControlQuery(CoreAjaxUrlRoot, 'export_proposals', {\n\t\t                'plugin': \"ReferralManagement\"\n\t\t                });\n    \t\t\t\t\/\/exportQuery.execute(); \/\/for testing.\n    \t\t\t\twindow.open(exportQuery.getUrl(true),'Download'); \n                }\n              \n          }\n        }\n      ]    \n        \n    },{\n        targetUIView:function(button, section, viewer){\n            return  viewer.getApplication().getChildView('content',0).getChildView('content',1);\n        },\n        templateView:function(button, section){\n            return button.view||(section.toLowerCase()+(button.name||button.html)+\"Detail\");\n        },\n        buttonClass:function(button, section){\n            return button[\"class\"]||(\"menu-\"+section.toLowerCase()+\"-\"+(button.name||button.html).toLowerCase())\n        },\n        sectionClass:function(section){\n            return \"menu-\"+section.toLowerCase()\n        },\n        \/\/ formatSectionLabel:function(section, labelEl){\n        \/\/     if(section==='People'){\n        \/\/         return 'Team';\n        \/\/     }\n        \/\/ },\n        initialView:{view:\"Dashboard\", section:\"Main\"}\n    });\n    \napplication.setNamedValue('navigationController', navigationController);\nreturn navigationController;",
        "identifier": "customScriptElement"
    }
}